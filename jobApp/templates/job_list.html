{% extends 'base.html' %}
{% load static %} {# Load static files if you use them for images, etc. #}

{% block title %}Job Listings - JobPortal{% endblock %}

{% block content %}
<div class="py-12 px-6 md:px-8 lg:px-12 bg-gray-100 min-h-screen">
    <div class="container mx-auto">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-8 text-center flex items-center justify-center">
            <i class="fas fa-search-plus text-blue-600 mr-3"></i> Explore Job Opportunities
        </h1>

        {# Django Messages Section #}
        {% if messages %}
            <div class="mb-6 space-y-3">
                {% for message in messages %}
                    <div class="p-4 rounded-lg flex items-center
                        {% if message.tags == 'success' %}bg-green-100 text-green-700 border border-green-400{% endif %}
                        {% if message.tags == 'error' %}bg-red-100 text-red-700 border border-red-400{% endif %}
                        {% if message.tags == 'info' %}bg-blue-100 text-blue-700 border border-blue-400{% endif %}
                        {% if message.tags == 'warning' %}bg-yellow-100 text-yellow-700 border border-yellow-400{% endif %}
                    " role="alert">
                        {% if message.tags == 'success' %}<i class="fas fa-check-circle mr-3 text-lg"></i>{% endif %}
                        {% if message.tags == 'error' %}<i class="fas fa-exclamation-circle mr-3 text-lg"></i>{% endif %}
                        {% if message.tags == 'info' %}<i class="fas fa-info-circle mr-3 text-lg"></i>{% endif %}
                        {% if message.tags == 'warning' %}<i class="fas fa-exclamation-triangle mr-3 text-lg"></i>{% endif %}
                        <div>{{ message }}</div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        <!-- Search and Filter Section -->
        <div class="bg-white rounded-lg p-6 card-shadow mb-8 border border-gray-200">
            <form method="GET" action="{% url 'job_list' %}" class="space-y-4 md:space-y-0 md:flex md:items-end md:space-x-4">
                <div class="flex-grow">
                    <label for="q" class="block text-sm font-medium text-gray-700 mb-1">Keywords / Title / Company / Location</label>
                    <input type="text" name="q" id="q" placeholder="e.g., Software Engineer, Remote, Google"
                           class="input-field" value="{{ current_query }}">
                </div>
                <div>
                    <label for="category" class="block text-sm font-medium text-gray-700 mb-1">Category</label>
                    <select name="category" id="category" class="input-field">
                        <option value="">All Categories</option>
                        {% for cat in categories %}
                            <option value="{{ cat.name }}" {% if current_category == cat.name %}selected{% endif %}>{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="job_type" class="block text-sm font-medium text-gray-700 mb-1">Job Type</label>
                    <select name="job_type" id="job_type" class="input-field">
                        <option value="">All Types</option>
                        {% for type in job_types %}
                            <option value="{{ type }}" {% if current_job_type == type %}selected{% endif %}>{{ type }}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn-primary w-full md:w-auto px-6 py-3">
                    <i class="fas fa-filter mr-2"></i> Filter Jobs
                </button>
            </form>
        </div>

        <!-- Job Listings Grid -->
        {% if jobs %}
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                {% for job in jobs %}
                    <div class="bg-white rounded-lg p-6 card-shadow border border-gray-200 relative overflow-hidden"> {# Added relative and overflow-hidden #}
                        {# NEW: Hot Job Banner (using is_hot_job flag from view) #}
                        {% if job.is_hot_job %}
                            <span class="absolute top-0 right-0 mt-3 mr-3 bg-red-500 text-white text-xs font-bold uppercase px-2 py-0.5 rounded-full shadow-md flex items-center transform rotate-3 origin-top-right">
                                <i class="fas fa-fire mr-1 text-sm"></i> Hot!
                            </span>
                        {% endif %}

                        <h2 class="text-xl font-bold text-gray-900 mb-2 mt-2">{{ job.title }}</h2>
                        <p class="text-blue-600 font-semibold mb-2">{{ job.company_name }}</p>
                        <p class="text-gray-600 text-sm mb-4"><i class="fas fa-map-marker-alt mr-1"></i> {{ job.location }}</p>

                        <div class="flex flex-wrap items-center gap-2 text-xs text-gray-600 mb-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 bg-blue-100 text-blue-800 rounded-full font-medium">
                                <i class="fas fa-briefcase mr-1"></i> {{ job.job_type }}
                            </span>
                            {% if job.category %}
                                <span class="inline-flex items-center px-2.5 py-0.5 bg-green-100 text-green-800 rounded-full font-medium">
                                    <i class="fas fa-tag mr-1"></i> {{ job.category.name }}
                                </span>
                            {% endif %}
                            <span class="inline-flex items-center px-2.5 py-0.5 bg-yellow-100 text-yellow-800 rounded-full font-medium">
                                <i class="fas fa-calendar-alt mr-1"></i> Posted: {{ job.date_posted|date:"M d, Y" }}
                            </span>
                            {# Job Expiry Date on list #}
                            {% if job.job_expiry_date %}
                                <span class="inline-flex items-center px-2.5 py-0.5 bg-red-100 text-red-800 rounded-full font-medium">
                                    <i class="fas fa-hourglass-end mr-1"></i> Expires: {{ job.job_expiry_date|date:"M d, Y" }}
                                </span>
                            {% else %}
                                <span class="inline-flex items-center px-2.5 py-0.5 bg-gray-100 text-gray-700 rounded-full font-medium">
                                    <i class="fas fa-calendar-times mr-1"></i> No Expiry
                                </span>
                            {% endif %}
                        </div>

                        <p class="text-gray-700 text-sm mb-6 line-clamp-3">{{ job.description|striptags|truncatechars:150 }}</p>

                        <div class="mt-auto"> {# Use mt-auto to push button to bottom #}
                            <a href="{% url 'job_detail' job.id %}" class="btn-primary text-sm inline-flex items-center justify-center w-full">
                                View Details <i class="fas fa-arrow-right ml-2"></i>
                            </a>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="bg-white rounded-lg p-8 card-shadow text-center text-gray-600 border border-gray-200">
                <i class="fas fa-exclamation-circle text-5xl text-yellow-500 mb-4"></i>
                <p class="text-xl font-semibold">No jobs found matching your criteria.</p>
                <p class="mt-2">Try adjusting your search filters or check back later!</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
