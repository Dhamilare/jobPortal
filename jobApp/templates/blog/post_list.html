{% extends "base.html" %}
{% load static %}

{% block title %}
    Blog Posts
{% endblock %}

{% block content %}
    <style>
        /* Custom styles for hover effects and shadows */
        .card-shadow {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-shadow:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .search-input {
            width: 100%;
            border-radius: 9999px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            transition: all 0.2s ease-in-out;
            border: 1px solid #e5e7eb;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }

        .search-btn {
            background-color: #4f46e5;
            color: white;
            padding: 0.75rem 2rem;
            border-radius: 9999px;
            font-weight: 600;
            transition: background-color 0.3s ease;
        }

        .search-btn:hover {
            background-color: #4338ca;
        }
    </style>

    <div class="container mx-auto px-4 py-12 lg:py-16 pt-8 sm:pt-28">

        <!-- Introductory Hero Section -->
        <div class="bg-gradient-to-br from-indigo-50 to-blue-50 rounded-3xl shadow-xl p-8 mb-16 text-center">
            <h3 class="text-3xl lg:text-4xl font-extrabold text-gray-900 mb-4 tracking-tight leading-tight">
                Welcome to the RRWT Blog
            </h3>
            <p class="text-lg text-gray-700 max-w-3xl mx-auto leading-relaxed font-light">
                Your go-to resource for everything remote work. From landing interviews to acing skills employers
                are searching for, we share expert tips, real success stories, and practical
                guides to help you stand out in todayâ€™s competitive job market.
            </p>
        </div>

        <div class="flex flex-col md:flex-row justify-between items-center mb-10 gap-6 md:gap-0">
            <h2 class="text-3xl lg:text-4xl font-extrabold text-gray-900">
                Latest Posts
            </h2>
            <!-- Show the 'Create New Post' button only to staff users -->
            {% if request.user.is_staff %}
            <a href="{% url 'blog_create' %}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105">
                <i class="fas fa-plus-circle mr-2"></i> Create New Post
            </a>
            {% endif %}
        </div>

        <!-- Search Form -->
        <div class="mb-12">
            <form action="{% url 'blog_list' %}" method="get" class="flex flex-col sm:flex-row items-center justify-center gap-4 w-full max-w-xl mx-auto">
                <input type="search" name="q" value="{{ query|default:'' }}" placeholder="Search posts..." class="search-input flex-1">
                <button type="submit" class="search-btn">
                    <i class="fas fa-search mr-2"></i> Search
                </button>
            </form>
        </div>

        {% if page_obj.object_list %}
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-10">
                {% for post in page_obj %}
                    <a href="{% url 'blog_detail' slug=post.slug %}" class="block bg-white rounded-3xl overflow-hidden card-shadow flex flex-col justify-between border border-gray-100 transition duration-300 ease-in-out transform hover:-translate-y-1 hover:shadow-2xl">
                        <!-- Featured Image -->
                        <div class="w-full h-48 overflow-hidden">
                            {% if post.image %}
                                <img src="{{ post.image.url }}" alt="{{ post.title }}" class="w-full h-full object-cover">
                            {% else %}
                                <img src="https://placehold.co/1200x600/E0F2FE/1E40AF?text=Post+Image" alt="{{ post.title }} featured image" class="w-full h-full object-cover">
                            {% endif %}
                        </div>

                        <div class="p-8">
                            <h3 class="text-2xl font-bold text-gray-900 mb-2 leading-snug">
                                {{ post.title }}
                            </h3>
                            <p class="text-sm text-gray-500 mb-4 font-medium">
                                By <span class="font-semibold text-gray-600">{{ post.author.get_full_name|default:post.author.username }}</span> on {{ post.created_at|date:"F j, Y" }}
                            </p>
                            <!-- Category Badge -->
                            {% if post.category %}
                            <span class="bg-blue-100 text-blue-800 text-xs font-semibold px-2.5 py-0.5 rounded-full uppercase tracking-wide mb-4 inline-block">
                                {{ post.category.name }}
                            </span>
                            {% endif %}
                            <!-- Summary of the post content -->
                            <p class="text-gray-600 line-clamp-3 mb-6 leading-relaxed">
                                {{ post.content|striptags|truncatechars:150 }}
                            </p>
                        </div>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-20 bg-white rounded-xl shadow-lg">
                <h2 class="text-3xl font-bold text-gray-700 mb-4">No posts found.</h2>
            </div>
        {% endif %}

        <!-- Pagination -->
        {% if page_obj.paginator.num_pages > 1 %}
            <nav class="mt-16 flex justify-center items-center space-x-2" aria-label="Pagination">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}{% if query %}&q={{ query }}{% endif %}" class="pagination-nav-btn text-gray-700 hover:text-blue-600">
                        <i class="fas fa-chevron-left mr-2"></i> Previous
                    </a>
                {% else %}
                    <span class="pagination-disabled-nav-btn text-gray-400">
                        <i class="fas fa-chevron-left mr-2"></i> Previous
                    </span>
                {% endif %}

                {% for i in paginator.page_range %}
                    {% if page_obj.number == i %}
                        <span class="bg-blue-600 text-white font-bold py-2 px-4 rounded-full">{{ i }}</span>
                    {% else %}
                        <a href="?page={{ i }}{% if query %}&q={{ query }}{% endif %}" class="text-gray-700 hover:bg-gray-100 py-2 px-4 rounded-full transition duration-200">{{ i }}</a>
                    {% endif %}
                {% endfor %}

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if query %}&q={{ query }}{% endif %}" class="pagination-nav-btn text-gray-700 hover:text-blue-600">
                        Next <i class="fas fa-chevron-right ml-2"></i>
                    </a>
                {% else %}
                    <span class="pagination-disabled-nav-btn text-gray-400">
                        Next <i class="fas fa-chevron-right ml-2"></i>
                    </span>
                {% endif %}
            </nav>
        {% endif %}
    </div>
{% endblock %}
